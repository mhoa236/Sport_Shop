<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TÃ i khoáº£n - Sports Shop</title>
  <base href="./">
  <link rel="stylesheet" href="assets/base.css">
  <script src="assets/app.js" defer></script>
  <style>
    .p-avatar { width:96px; height:96px; border-radius:50%; object-fit:cover; border:1px solid var(--bd); background:#eee; }
    .p-avatar-placeholder { width:96px; height:96px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:#ddd; color:#555; font-weight:700; border:1px solid var(--bd); }
  </style>
</head>
<body>
<header>
  <a href="index.html"><strong>ğŸª Sports Shop</strong></a>

  <nav>
    <a href="sports.html">Bá»™ mÃ´n</a>
    <a href="sale.html">Giáº£m giÃ¡</a>
    <a id="navAdmin" href="admin-products.html" style="display:none">Admin</a>
  </nav>

  <div class="header-right">
    <!-- thanh tÃ¬m kiáº¿m -->
    <form class="search" action="search.html" method="get">
      <input name="q" placeholder="TÃ¬m kiáº¿m sáº£n pháº©m...">
      <button type="submit">TÃ¬m</button>
    </form>

    <!-- Dropdown tÃ i khoáº£n -->
    <div class="account-wrap">
      <button id="accountBtn" class="icon-btn" aria-haspopup="menu" aria-expanded="false" aria-label="TÃ i khoáº£n">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path stroke="currentColor" stroke-width="1.6"
                d="M20 21a8 8 0 1 0-16 0m8-9a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z"/>
        </svg>
      </button>

      <div class="account-menu">
        <!-- tráº¡ng thÃ¡i Ä‘Äƒng nháº­p sáº½ Ä‘iá»u khiá»ƒn áº©n/hiá»‡n máº¥y dÃ²ng dÆ°á»›i -->
        <a class="account-item" href="account.html">Trang cÃ¡ nhÃ¢n</a>
        <a class="account-item" href="cart.html">Giá» hÃ ng <span id="cartCount" class="badge-num">0</span></a>
        <a class="account-item" href="wishlist.html">Wishlist <span id="wishCount" class="badge-num">0</span></a>
        <div class="hr"></div>
        <a id="loginItem" class="account-item" href="login.html">ÄÄƒng nháº­p</a>
        <a id="registerItem" class="account-item" href="register.html">ÄÄƒng kÃ½</a>
        <a id="logoutItem" class="account-item" href="#">ÄÄƒng xuáº¥t</a>
      </div>
    </div>
  </div>
</header>


<div class="container">
  <h1>Trang cÃ¡ nhÃ¢n</h1>
  <div class="row">
    <div class="w-50 card">
      <h3>áº¢nh Ä‘áº¡i diá»‡n & ThÃ´ng tin</h3>
      <div class="row" style="align-items:center">
        <div id="avatarBox"></div>
        <div>
          <input id="avatarInput" type="file" accept="image/*">
          <div class="small">Táº£i áº£nh â‰¤ 1MB, dáº¡ng JPG/PNG.</div>
        </div>
      </div>
      <div class="hr"></div>
      <form id="profile" class="grid" style="gap:8px">
        <input name="full_name" placeholder="Há» tÃªn" required>
        <input name="email" placeholder="Email" type="email" required disabled>
        <input name="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
        <input name="line1" placeholder="Äá»‹a chá»‰">
        <button>LÆ°u thay Ä‘á»•i</button>
      </form>
      <div class="small" id="saved" style="margin-top:8px"></div>
    </div>

    <div class="w-50 card">
      <h3>ÄÆ¡n hÃ ng cá»§a tÃ´i</h3>
      <table id="orders">
        <thead><tr><th>MÃ£</th><th>NgÃ y</th><th>Tráº¡ng thÃ¡i</th><th>Tá»•ng</th></tr></thead>
        <tbody><!-- render --></tbody>
      </table>
    </div>
  </div>
</div>

<footer>Â© 2025 Sports Shop â€” <a href="policy-contact.html">ChÃ­nh sÃ¡ch & LiÃªn há»‡</a></footer>

<script>
(function(){
  const fmt = n => (n||0).toLocaleString('vi-VN') + 'Ä‘';
  const auth = JSON.parse(localStorage.getItem('auth') || 'null');
  if(!auth){ alert('Vui lÃ²ng Ä‘Äƒng nháº­p.'); location.href='login.html'; return; }

  // Láº¥y user theo email
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const user = users.find(u => u.email === auth.email) || { email: auth.email, full_name: auth.full_name || 'User', avatar:'', phone:'', line1:'' };

  // Render avatar
  const box = document.getElementById('avatarBox');
  function renderAvatar(){
    box.innerHTML = '';
    if (user.avatar) {
      const img = document.createElement('img');
      img.src = user.avatar; img.className='p-avatar';
      box.appendChild(img);
    } else {
      const init = (user.full_name || user.email || 'U').trim().charAt(0).toUpperCase();
      const div = document.createElement('div');
      div.className='p-avatar-placeholder'; div.textContent = init;
      box.appendChild(div);
    }
  }
  renderAvatar();

  // Upload avatar
  const input = document.getElementById('avatarInput');
  input.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(!file) return;
    if(file.size > 1024*1024){ alert('áº¢nh quÃ¡ lá»›n (>1MB).'); input.value=''; return; }
    const fr = new FileReader();
    fr.onload = () => {
      user.avatar = fr.result; // base64
      saveUser();
      renderAvatar();
      alert('ÄÃ£ cáº­p nháº­t áº£nh Ä‘áº¡i diá»‡n!');
    };
    fr.readAsDataURL(file);
  });

  // Form profile
  const pf = document.getElementById('profile');
  const saved = document.getElementById('saved');
  ['full_name','email','phone','line1'].forEach(k => { if(pf[k]) pf[k].value = user[k] || ''; });
  pf.addEventListener('submit', e=>{
    e.preventDefault();
    const fd = new FormData(pf);
    user.full_name = fd.get('full_name');
    user.phone = fd.get('phone') || '';
    user.line1 = fd.get('line1') || '';
    saveUser();
    // cáº­p nháº­t auth name Ä‘á»ƒ header láº¥y initials Ä‘Ãºng
    localStorage.setItem('auth', JSON.stringify({ email: user.email, full_name: user.full_name }));
    saved.textContent = 'ÄÃ£ lÆ°u thÃ´ng tin!';
    setTimeout(()=> saved.textContent='', 2000);
  });

  function saveUser(){
    const idx = users.findIndex(u => u.email === user.email);
    if (idx >= 0) users[idx] = user; else users.push(user);
    localStorage.setItem('users', JSON.stringify(users));
  }

  // ÄÆ¡n hÃ ng demo
  const orders = JSON.parse(localStorage.getItem('orders') || '[]');
  if (!orders.length) {
    orders.push({id:1001, date:'14/10/2025', status:'pending', total:1020000});
    localStorage.setItem('orders', JSON.stringify(orders));
  }
  const tb = document.querySelector('#orders tbody');
  tb.innerHTML = orders.map(o => `<tr><td>#${o.id}</td><td>${o.date}</td><td>${o.status}</td><td>${fmt(o.total)}</td></tr>`).join('');
})();
</script>
</body>
</html>
